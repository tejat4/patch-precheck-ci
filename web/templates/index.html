<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patch Pre-Check CI Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            color: #2d3748;
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .status-badge.configured {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .status-badge.not-configured {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
        }

        .config-info-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .config-info-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        /* Grid Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .card-header i {
            font-size: 1.5rem;
            color: #667eea;
        }

        .card-header h2 {
            color: #2d3748;
            font-size: 1.3rem;
            font-weight: 700;
        }

        /* Action Buttons */
        .action-section {
            margin-bottom: 20px;
        }

        .action-btn-wrapper {
            position: relative;
        }

        .btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: linear-gradient(135deg, #cbd5e0, #a0aec0);
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78, #38a169);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565, #e53e3e);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
            width: auto;
        }

        /* Progress Bar */
        .progress-container {
            margin-top: 15px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-status {
            font-weight: 600;
            color: #2d3748;
        }

        .progress-status.running {
            color: #667eea;
        }

        .progress-status.completed {
            color: #48bb78;
        }

        .progress-status.failed {
            color: #f56565;
        }

        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-fill.indeterminate {
            width: 30% !important;
            animation: indeterminate 1.5s ease-in-out infinite;
        }

        @keyframes indeterminate {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(400%); }
        }

        .progress-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        /* Test List */
        .test-grid {
            display: grid;
            gap: 12px;
        }

        .test-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .test-item:hover {
            background: #edf2f7;
            transform: translateX(5px);
        }

        .test-info {
            flex: 1;
        }

        .test-name {
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .test-desc {
            font-size: 0.85rem;
            color: #718096;
        }

        .test-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .test-status-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .test-status-icon.running {
            background: #90cdf4;
            color: #2c5282;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .test-status-icon.completed {
            background: #9ae6b4;
            color: #22543d;
        }

        .test-status-icon.failed {
            background: #fc8181;
            color: #742a2a;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-header h3 {
            color: #2d3748;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #718096;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: #f7fafc;
            color: #2d3748;
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 25px;
        }

        .form-section-title {
            color: #667eea;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-label {
            display: block;
            color: #2d3748;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Log Viewer */
        .log-modal .modal {
            max-width: 1000px;
        }

        .log-output {
            background: #1a202c;
            color: #68d391;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
            line-height: 1.5;
        }

        .log-output::-webkit-scrollbar {
            width: 8px;
        }

        .log-output::-webkit-scrollbar-track {
            background: #2d3748;
            border-radius: 10px;
        }

        .log-output::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 10px;
        }

        /* Config Display */
        .config-display {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-label {
            font-weight: 600;
            color: #4a5568;
        }

        .config-value {
            color: #2d3748;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
        }

        /* Utilities */
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-warning {
            background: #fef5e7;
            color: #856404;
            border-left: 4px solid #ed8936;
        }

        .select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        /* Footer */
        .footer {
            background: white;
            border-radius: 16px;
            padding: 25px 30px;
            margin-top: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer-left {
            flex: 1;
            min-width: 200px;
        }

        .footer-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .footer-subtitle {
            font-size: 0.85rem;
            color: #718096;
        }

        .footer-center {
            flex: 1;
            text-align: center;
            min-width: 250px;
        }

        .copyright {
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .copyright strong {
            color: #667eea;
        }

        .contact {
            font-size: 0.85rem;
            color: #718096;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .contact i {
            color: #667eea;
        }

        .contact a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.3s;
        }

        .contact a:hover {
            color: #5a67d8;
            text-decoration: underline;
        }

        .footer-right {
            flex: 1;
            text-align: right;
            min-width: 150px;
        }

        .github-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #2d3748;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(45, 55, 72, 0.2);
        }

        .github-link:hover {
            background: #1a202c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 55, 72, 0.3);
        }

        .github-link i {
            font-size: 1.3rem;
        }

        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
                text-align: center;
            }

            .footer-left,
            .footer-center,
            .footer-right {
                text-align: center;
                width: 100%;
            }

            .contact {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <div class="header-content">
                    <h1>
                        <i class="fas fa-tools"></i>
                        Patch Pre-Check CI Dashboard
                    </h1>
                    <div class="status-info">
                        <span class="status-badge" :class="systemStatus.configured ? 'configured' : 'not-configured'">
                            <i :class="systemStatus.configured ? 'fas fa-check-circle' : 'fas fa-exclamation-circle'"></i>
                            {{ systemStatus.configured ? 'Configured' : 'Not Configured' }}
                        </span>
                        <span v-if="systemStatus.distro" style="color: #718096; font-weight: 600;">
                            {{ systemStatus.distro === 'anolis' ? 'OpenAnolis' : 'openEuler' }}
                        </span>
                        <button v-if="systemStatus.configured" class="config-info-btn" @click="showConfigInfo">
                            <i class="fas fa-info-circle"></i> View Config
                        </button>
                    </div>
                </div>
            </div>

            <!-- Alert -->
            <div v-if="!systemStatus.configured" class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <span>System is not configured. Please select a distribution and configure the system first.</span>
            </div>

            <!-- Main Grid -->
            <div class="main-grid">
                <!-- Left Column: Actions -->
                <div>
                    <!-- Configuration Card -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-header">
                            <i class="fas fa-cog"></i>
                            <h2>Configuration</h2>
                        </div>
                        <select v-model="selectedDistro" class="select">
                            <option value="">Select Distribution</option>
                            <option value="anolis">OpenAnolis</option>
                            <option value="euler">openEuler</option>
                        </select>
                        <button class="btn" @click="configure" :disabled="!selectedDistro">
                            <i class="fas fa-cog"></i>
                            {{ systemStatus.configured ? 'Reconfigure' : 'Configure' }} System
                        </button>
                    </div>

                    <!-- Build Card -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-header">
                            <i class="fas fa-hammer"></i>
                            <h2>Build</h2>
                        </div>
                        <div class="action-section">
                            <button class="btn btn-success" @click="runBuild" :disabled="!systemStatus.configured || buildJob.status === 'running'">
                                <i class="fas fa-play"></i>
                                Run Build
                            </button>
                            <div v-if="buildJob.status" class="progress-container">
                                <div class="progress-header">
                                    <span class="progress-status" :class="buildJob.status">
                                        <i :class="getStatusIcon(buildJob.status)"></i>
                                        {{ buildJob.status.toUpperCase() }}
                                    </span>
                                    <span style="font-size: 0.85rem; color: #718096;">{{ buildJob.elapsed }}</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" :class="buildJob.status === 'running' ? 'indeterminate' : ''" :style="{width: buildJob.progress + '%'}"></div>
                                </div>
                                <div class="progress-actions">
                                    <button class="btn btn-small" @click="showLog(buildJob.id)">
                                        <i class="fas fa-file-alt"></i> View Log
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Test All Card -->
                    <div class="card" style="margin-bottom: 20px;">
                        <div class="card-header">
                            <i class="fas fa-vial"></i>
                            <h2>Run All Tests</h2>
                        </div>
                        <div class="action-section">
                            <button class="btn" @click="runAllTests" :disabled="!systemStatus.configured || testAllJob.status === 'running'">
                                <i class="fas fa-play-circle"></i>
                                Run All Tests
                            </button>
                            <div v-if="testAllJob.status" class="progress-container">
                                <div class="progress-header">
                                    <span class="progress-status" :class="testAllJob.status">
                                        <i :class="getStatusIcon(testAllJob.status)"></i>
                                        {{ testAllJob.status.toUpperCase() }}
                                    </span>
                                    <span style="font-size: 0.85rem; color: #718096;">{{ testAllJob.elapsed }}</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" :class="testAllJob.status === 'running' ? 'indeterminate' : ''" :style="{width: testAllJob.progress + '%'}"></div>
                                </div>
                                <div class="progress-actions">
                                    <button class="btn btn-small" @click="showLog(testAllJob.id)">
                                        <i class="fas fa-file-alt"></i> View Log
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Maintenance Card -->
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-wrench"></i>
                            <h2>Maintenance</h2>
                        </div>
                        <button class="btn btn-warning" @click="runClean" style="margin-bottom: 10px;">
                            <i class="fas fa-broom"></i>
                            Clean
                        </button>
                        <button class="btn btn-danger" @click="runReset" :disabled="!systemStatus.configured">
                            <i class="fas fa-undo"></i>
                            Reset
                        </button>
                    </div>
                </div>

                <!-- Right Column: Tests -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list-check"></i>
                        <h2>Available Tests</h2>
                    </div>
                    
                    <div v-if="loading" class="loading">
                        <div class="spinner"></div>
                        <p>Loading tests...</p>
                    </div>
                    
                    <div v-else-if="!systemStatus.configured" class="empty-state">
                        <i class="fas fa-info-circle"></i>
                        <p>Please configure the system to see available tests</p>
                    </div>
                    
                    <div v-else-if="tests.length > 0" class="test-grid">
                        <div v-for="test in tests" :key="test.name" class="test-item">
                            <div class="test-info">
                                <div class="test-name">{{ test.name }}</div>
                                <div class="test-desc">{{ test.description }}</div>
                            </div>
                            <div class="test-actions">
                                <div v-if="testJobs[test.name]" class="test-status-icon" :class="testJobs[test.name].status">
                                    <i v-if="testJobs[test.name].status === 'running'" class="fas fa-spinner fa-spin"></i>
                                    <i v-else-if="testJobs[test.name].status === 'completed'" class="fas fa-check"></i>
                                    <i v-else-if="testJobs[test.name].status === 'failed'" class="fas fa-times"></i>
                                </div>
                                <button class="btn btn-small" @click="runTest(test.name)" :disabled="testJobs[test.name] && testJobs[test.name].status === 'running'">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button v-if="testJobs[test.name]" class="btn btn-small btn-warning" @click="showLog(testJobs[test.name].id)">
                                    <i class="fas fa-file-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div v-else class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No tests available</p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="footer">
                <div class="footer-content">
                    <div class="footer-left">
                        <p class="footer-title">Patch Pre-Check CI Tool</p>
                        <p class="footer-subtitle">Automated kernel patch validation and testing</p>
                    </div>
                    <div class="footer-center">
                        <p class="copyright">
                            © 2025 | Developed by <strong>Hemanth Selam</strong>
                        </p>
                        <p class="contact">
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:Hemanth.Selam@amd.com">Hemanth.Selam@amd.com</a>
                        </p>
                    </div>
                    <div class="footer-right">
                        <a href="https://github.com/SelamHemanth" target="_blank" class="github-link">
                            <i class="fab fa-github"></i>
                            <span>SelamHemanth</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Configuration Modal -->
            <div v-if="showConfigModal" class="modal-overlay" @click.self="closeConfigModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3>
                            <i class="fas fa-cog"></i>
                            Configure {{ selectedDistro === 'anolis' ? 'OpenAnolis' : 'openEuler' }}
                        </h3>
                        <button class="modal-close" @click="closeConfigModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div v-if="loadingFields" class="loading">
                        <div class="spinner"></div>
                        <p>Loading configuration fields...</p>
                    </div>

                    <form v-else @submit.prevent="submitConfig">
                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-file-alt"></i>
                                General Configuration
                            </div>
                            <div v-for="field in configFields.general" :key="field.name" class="form-group">
                                <label class="form-label">{{ field.label }}</label>
                                <select v-if="field.type === 'select'" v-model="configData[field.name]" class="form-input" :required="field.required">
                                    <option value="">Select...</option>
                                    <option v-for="opt in field.options" :key="opt" :value="opt">{{ opt }}</option>
                                </select>
                                <input v-else v-model="configData[field.name]" :type="field.type" :placeholder="field.default ? String(field.default) : ''" class="form-input" :required="field.required" />
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-hammer"></i>
                                Build Configuration
                            </div>
                            <div v-for="field in configFields.build" :key="field.name" class="form-group">
                                <label class="form-label">{{ field.label }}</label>
                                <input v-model="configData[field.name]" :type="field.type" :placeholder="field.default ? String(field.default) : ''" class="form-input" :required="field.required" />
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-desktop"></i>
                                VM Configuration
                            </div>
                            <div v-for="field in configFields.vm" :key="field.name" class="form-group">
                                <label class="form-label">{{ field.label }}</label>
                                <input v-model="configData[field.name]" :type="field.type" class="form-input" :required="field.required" />
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-lock"></i>
                                Host Configuration
                            </div>
                            <div v-for="field in configFields.host" :key="field.name" class="form-group">
                                <label class="form-label">{{ field.label }}</label>
                                <input v-model="configData[field.name]" :type="field.type" class="form-input" :required="field.required" />
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="button" class="btn" style="background: #cbd5e0; color: #2d3748;" @click="closeConfigModal">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> Save Configuration
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Config Info Modal -->
            <div v-if="showConfigInfoModal" class="modal-overlay" @click.self="showConfigInfoModal = false">
                <div class="modal">
                    <div class="modal-header">
                        <h3>
                            <i class="fas fa-info-circle"></i>
                            Current Configuration
                        </h3>
                        <button class="modal-close" @click="showConfigInfoModal = false">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div v-if="loadingConfig" class="loading">
                        <div class="spinner"></div>
                        <p>Loading configuration...</p>
                    </div>
                    <div v-else class="config-display">
                        <div v-for="(value, key) in currentConfig" :key="key" class="config-item">
                            <span class="config-label">{{ formatConfigKey(key) }}</span>
                            <span class="config-value">{{ value }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Log Viewer Modal -->
            <div v-if="showLogModal" class="modal-overlay log-modal" @click.self="closeLogModal">
                <div class="modal">
                    <div class="modal-header">
                        <h3>
                            <i class="fas fa-file-alt"></i>
                            Job Log
                        </h3>
                        <button class="modal-close" @click="closeLogModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div v-if="loadingLog" class="loading">
                        <div class="spinner"></div>
                        <p>Loading log...</p>
                    </div>
                    <div v-else class="log-output">{{ currentLog || 'No log available' }}</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    systemStatus: { configured: false, distro: null },
                    selectedDistro: '',
                    tests: [],
                    jobs: [],
                    testJobs: {},
                    buildJob: {},
                    testAllJob: {},
                    loading: false,
                    pollInterval: null,
                    showConfigModal: false,
                    showConfigInfoModal: false,
                    showLogModal: false,
                    loadingFields: false,
                    loadingConfig: false,
                    loadingLog: false,
                    configFields: { general: [], build: [], vm: [], host: [] },
                    configData: {},
                    currentConfig: {},
                    currentLog: ''
                };
            },
            mounted() {
                this.loadStatus();
                this.loadTests();
                this.loadJobs();
                this.pollInterval = setInterval(() => {
                    this.loadJobs();
                    this.updateJobProgress();
                }, 2000);
            },
            beforeUnmount() {
                if (this.pollInterval) clearInterval(this.pollInterval);
            },
            methods: {
                async loadStatus() {
                    try {
                        const response = await axios.get('/api/status');
                        this.systemStatus = response.data;
                        if (this.systemStatus.configured) this.loadTests();
                    } catch (error) {
                        console.error('Failed to load status:', error);
                    }
                },
                async loadTests() {
                    if (!this.systemStatus.configured) return;
                    this.loading = true;
                    try {
                        const response = await axios.get('/api/tests');
                        this.tests = response.data.tests || [];
                    } catch (error) {
                        console.error('Failed to load tests:', error);
                    } finally {
                        this.loading = false;
                    }
                },
                async loadJobs() {
                    try {
                        const response = await axios.get('/api/jobs');
                        this.jobs = response.data;
                        this.categorizeJobs();
                    } catch (error) {
                        console.error('Failed to load jobs:', error);
                    }
                },
                categorizeJobs() {
                    // Categorize jobs
                    const buildJob = this.jobs.find(j => j.command === 'make build');
                    const testAllJob = this.jobs.find(j => j.command === 'make test');
                    
                    if (buildJob) this.buildJob = { ...buildJob, elapsed: this.calculateElapsed(buildJob) };
                    if (testAllJob) this.testAllJob = { ...testAllJob, elapsed: this.calculateElapsed(testAllJob) };
                    
                    // Individual test jobs
                    this.jobs.forEach(job => {
                        if (job.test_name) {
                            this.testJobs[job.test_name] = { ...job, elapsed: this.calculateElapsed(job) };
                        }
                    });
                },
                calculateElapsed(job) {
                    if (!job.start_time) return '';
                    const start = new Date(job.start_time);
                    const end = job.end_time ? new Date(job.end_time) : new Date();
                    const diff = Math.floor((end - start) / 1000);
                    const mins = Math.floor(diff / 60);
                    const secs = diff % 60;
                    return `${mins}m ${secs}s`;
                },
                updateJobProgress() {
                    if (this.buildJob.status === 'completed') this.buildJob.progress = 100;
                    else if (this.buildJob.status === 'failed') this.buildJob.progress = 100;
                    
                    if (this.testAllJob.status === 'completed') this.testAllJob.progress = 100;
                    else if (this.testAllJob.status === 'failed') this.testAllJob.progress = 100;
                },
                getStatusIcon(status) {
                    const icons = {
                        running: 'fas fa-spinner fa-spin',
                        completed: 'fas fa-check-circle',
                        failed: 'fas fa-times-circle',
                        queued: 'fas fa-clock'
                    };
                    return icons[status] || 'fas fa-question-circle';
                },
                async configure() {
                    if (!this.selectedDistro) {
                        alert('Please select a distribution first');
                        return;
                    }
                    this.showConfigModal = true;
                    this.loadingFields = true;
                    try {
                        const response = await axios.get('/api/config/fields', { params: { distro: this.selectedDistro } });
                        this.configFields = response.data.fields;
                        this.configData = {};
                        Object.values(this.configFields).forEach(section => {
                            section.forEach(field => {
                                if (field.default) this.configData[field.name] = field.default;
                            });
                        });
                    } catch (error) {
                        alert('Failed to load configuration fields');
                        this.showConfigModal = false;
                    } finally {
                        this.loadingFields = false;
                    }
                },
                closeConfigModal() {
                    this.showConfigModal = false;
                    this.configData = {};
                },
                async submitConfig() {
                    try {
                        await axios.post('/api/config', { distro: this.selectedDistro, config: this.configData });
                        alert('Configuration saved successfully!');
                        this.closeConfigModal();
                        this.loadStatus();
                    } catch (error) {
                        alert('Configuration failed');
                    }
                },
                async showConfigInfo() {
                    this.showConfigInfoModal = true;
                    this.loadingConfig = true;
                    try {
                        const response = await axios.get('/api/config');
                        this.currentConfig = response.data;
                    } catch (error) {
                        alert('Failed to load configuration');
                        this.showConfigInfoModal = false;
                    } finally {
                        this.loadingConfig = false;
                    }
                },
                formatConfigKey(key) {
                    return key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                },
                async showLog(jobId) {
                    this.showLogModal = true;
                    this.loadingLog = true;
                    this.currentLog = '';
                    try {
                        const response = await axios.get(`/api/jobs/${jobId}/log`);
                        this.currentLog = response.data.log;
                    } catch (error) {
                        this.currentLog = 'Failed to load log';
                    } finally {
                        this.loadingLog = false;
                    }
                },
                closeLogModal() {
                    this.showLogModal = false;
                    this.currentLog = '';
                },
                async runBuild() {
                    try {
                        await axios.post('/api/build');
                        this.loadJobs();
                    } catch (error) {
                        alert('Failed to start build');
                    }
                },
                async runAllTests() {
                    try {
                        await axios.post('/api/test/all');
                        this.loadJobs();
                    } catch (error) {
                        alert('Failed to start tests');
                    }
                },
                async runTest(testName) {
                    try {
                        await axios.post(`/api/test/${testName}`);
                        this.loadJobs();
                    } catch (error) {
                        alert('Failed to start test');
                    }
                },
                async runClean() {
                    const confirmed = confirm(
                        '⚠️ Clean Operation\n\n' +
                        'This will remove:\n' +
                        '• logs/ directory\n' +
                        '• patches/ directory\n' +
                        '• Build artifacts\n\n' +
                        'Do you want to continue?'
                    );
                    
                    if (!confirmed) {
                        return;
                    }
                    
                    try {
                        const response = await axios.post('/api/clean');
                        alert('✓ Clean operation started successfully!');
                        this.loadJobs();
                    } catch (error) {
                        alert('❌ Failed to start clean operation: ' + error.message);
                    }
                },
                async runReset() {
                    const confirmed = confirm(
                        '⚠️ Reset Operation\n\n' +
                        'This will reset the git repository to the saved HEAD commit.\n' +
                        'All uncommitted changes will be lost!\n\n' +
                        'Are you absolutely sure you want to continue?'
                    );
                    
                    if (!confirmed) {
                        return;
                    }
                    
                    // Double confirmation for reset
                    const doubleConfirm = confirm(
                        '⚠️ FINAL CONFIRMATION\n\n' +
                        'This action cannot be undone.\n' +
                        'Click OK to proceed with reset.'
                    );
                    
                    if (!doubleConfirm) {
                        return;
                    }
                    
                    try {
                        const response = await axios.post('/api/reset');
                        alert('✓ Reset operation started successfully!');
                        this.loadJobs();
                    } catch (error) {
                        alert('❌ Failed to start reset operation: ' + error.message);
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
